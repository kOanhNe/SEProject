<div th:fragment="notification-bell" class="inv-notification-wrapper">
    
    <!-- 1. N√öT CHU√îNG -->
    <div class="inv-bell-trigger" onclick="toggleNotification()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="inv-bi bi-bell-fill" viewBox="0 0 16 16">
            <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zm.995-14.901a1 1 0 1 0-1.99 0A5.002 5.002 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901z"/>
        </svg>
        <span class="inv-notification-badge"
              th:if="${notifications != null && !notifications.isEmpty()}"
              th:text="${notifications.size()}">3</span>
    </div>

    <div id="notificationDropdown" class="inv-notification-dropdown">
        <div class="inv-dropdown-header">
            <h6>Th√¥ng b√°o</h6>
        </div>
        
        <div class="inv-dropdown-body">
            
            <!-- TR∆Ø·ªúNG H·ª¢P 1: KH√îNG C√ì TH√îNG B√ÅO -->
            <div th:if="${notifications == null || notifications.isEmpty()}" class="inv-empty-state">
                <p>Kho h√†ng ·ªïn ƒë·ªãnh ‚úÖ</p>
            </div>

            <!-- TR∆Ø·ªúNG H·ª¢P 2: C√ì TH√îNG B√ÅO (Ph·∫£i t√°ch ri√™ng ra kh·ªèi div ·ªü tr√™n) -->
            <div th:if="${notifications != null && !notifications.isEmpty()}">
                <a th:each="item : ${notifications}" href="#" class="inv-notify-item">
                    <div class="inv-notify-icon">
                        <span th:if="${item.status.name() == 'OUT_OF_STOCK'}">üî¥</span>
                        <span th:if="${item.status.name() == 'ALMOST_OUT_OF_STOCK'}">‚ö†Ô∏è</span>
                    </div>
                    <div class="inv-notifi-content">
                        <div class="inv-notify-title" th:text="${item.shoeName}"></div>
                        <div class="inv-notify-desc">
                            <span th:if="${item.status.name() == 'OUT_OF_STOCK'}" class="inv-text-danger">ƒê√£ h·∫øt h√†ng</span>
                            <span th:if="${item.status.name() == 'ALMOST_OUT_OF_STOCK'}" class="inv-text-warning">
                                Ch·ªâ c√≤n <b th:text="${item.quantity}"></b> ƒë√¥i
                            </span>
                        </div>
                    </div>
                </a>
            </div>

        </div>
    </div>

    <!-- 3. SCRIPT (ƒê√£ s·ª≠a l·ªói ch√≠nh t·∫£ closet -> closest) -->
    <script>
        function toggleNotification(){
            var dropdown = document.getElementById("notificationDropdown");
            if(dropdown) {
                dropdown.classList.toggle("show");
            }
        }
        
        window.onclick = function(event){
            // S·ª≠a closet -> closest
            if (!event.target.closest('.inv-notification-wrapper')){
                var dropdown = document.getElementById("notificationDropdown");
                // S·ª≠a classlist -> classList
                if (dropdown && dropdown.classList.contains('show')){
                    dropdown.classList.remove('show');
                }
            }
        }
    </script>
</div>