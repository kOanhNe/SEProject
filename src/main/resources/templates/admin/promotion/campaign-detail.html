<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chi tiết chiến dịch</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
</head>
<body>
<div class="admin-layout">
    <aside class="sidebar">
        <div th:replace="~{admin/sidebar :: sidebar}"></div>
    </aside>
    <div class="main">
        <header class="topbar">
            <div class="topbar-inner">
                <div class="topbar-left">
                    <button class="menu-toggle" aria-label="Toggle menu">☰</button>
                    <h3>Chi tiết chiến dịch</h3>
                </div>
                <div class="topbar-right">
                    <a class="btn btn-secondary" th:href="@{/admin/promotions/campaigns}">Quay lại</a>
                    <a class="btn btn-primary" th:href="@{|/admin/promotions/campaigns/${campaign.campaignId}/edit|}">Chỉnh sửa</a>
                </div>
            </div>
        </header>
        <main class="page-content">
            <div class="card" style="max-width: 900px; margin: 0 auto;">
                <!-- Header Section -->
                <div style="border-bottom: 2px solid #e5e7eb; padding-bottom: 20px; margin-bottom: 24px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <h2 style="margin: 0; font-size: 28px; font-weight: 700;" th:text="${campaign.name}">Tên chiến dịch</h2>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span class="badge"
                                  th:classappend="${campaign.status.name() == 'ACTIVE'} ? ' badge-success' : (${campaign.status.name() == 'ENDED' || campaign.status.name() == 'CANCELLED'} ? ' badge-danger' : ' badge-warning')">
                                <span th:if="${campaign.status.name() == 'DRAFT'}">Nháp</span>
                                <span th:if="${campaign.status.name() == 'ACTIVE'}">Đang hoạt động</span>
                                <span th:if="${campaign.status.name() == 'ENDED'}">Đã kết thúc</span>
                                <span th:if="${campaign.status.name() == 'CANCELLED'}">Đã hủy</span>
                            </span>
                            <span th:if="${campaign.enabled}" class="chip-on">● Đang bật</span>
                            <span th:unless="${campaign.enabled}" class="chip-off">● Đã tắt</span>
                        </div>
                    </div>
                    <p style="color: #6b7280; font-size: 15px; margin: 0;" th:text="${campaign.description}">Mô tả chiến dịch</p>
                </div>

                <!-- Info Grid -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 32px;">
                    <!-- Thời gian -->
                    <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 20px; border-left: 4px solid #0284c7;">
                        <div style="color: #075985; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Thời gian hiệu lực</div>
                        <div style="font-size: 16px; font-weight: 600; color: #0c4a6e;">
                            <span th:text="${#temporals.format(campaign.startDate, 'dd/MM/yyyy')}">01/01/2024</span>
                            <span style="color: #64748b; margin: 0 8px;">→</span>
                            <span th:text="${#temporals.format(campaign.endDate, 'dd/MM/yyyy')}">31/12/2024</span>
                        </div>
                    </div>

                    <!-- ID -->
                    <div style="background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%); border-radius: 12px; padding: 20px; border-left: 4px solid #ca8a04;">
                        <div style="color: #713f12; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Campaign ID</div>
                        <div style="font-size: 18px; font-weight: 700; color: #854d0e;" th:text="${campaign.campaignId}">1</div>
                    </div>
                </div>

                <!-- Discount Rules -->
                <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #86efac; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
                    <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 700; color: #166534;">Quy tắc giảm giá</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div>
                            <div style="color: #15803d; font-size: 13px; font-weight: 600; margin-bottom: 4px;">Loại giảm giá</div>
                            <div style="font-size: 16px; font-weight: 600; color: #166534;">
                                <span th:if="${campaign.discountType.name() == 'PERCENT'}">Phần trăm (%)</span>
                                <span th:if="${campaign.discountType.name() == 'FIXED_AMOUNT'}">Số tiền cố định (VNĐ)</span>
                            </div>
                        </div>
                        <div>
                            <div style="color: #15803d; font-size: 13px; font-weight: 600; margin-bottom: 4px;">Giá trị giảm</div>
                            <div style="font-size: 24px; font-weight: 700; color: #166534;">
                                <span th:if="${campaign.discountType.name() == 'PERCENT'}" th:text="${campaign.discountValue}">10</span>
                                <span th:if="${campaign.discountType.name() == 'FIXED_AMOUNT'}" th:text="${#numbers.formatDecimal(campaign.discountValue, 0, 'POINT', 0, 'COMMA')}">1.000.000</span>
                                <span th:if="${campaign.discountType.name() == 'PERCENT'}">%</span>
                                <span th:if="${campaign.discountType.name() == 'FIXED_AMOUNT'}"> VNĐ</span>
                            </div>
                        </div>
                        <div>
                            <div style="color: #15803d; font-size: 13px; font-weight: 600; margin-bottom: 4px;">Giảm tối đa</div>
                            <div style="font-size: 16px; font-weight: 600; color: #166534;">
                                <span th:if="${campaign.maxDiscountAmount != null}">
                                    <span th:text="${#numbers.formatDecimal(campaign.maxDiscountAmount, 0, 'POINT', 0, 'COMMA')}">100.000</span> VNĐ
                                </span>
                                <span th:unless="${campaign.maxDiscountAmount != null}" style="color: #9ca3af;">Không giới hạn</span>
                            </div>
                        </div>
                        <div>
                            <div style="color: #15803d; font-size: 13px; font-weight: 600; margin-bottom: 4px;">Đơn hàng tối thiểu</div>
                            <div style="font-size: 16px; font-weight: 600; color: #166534;">
                                <span th:if="${campaign.minOrderValue != null}">
                                    <span th:text="${#numbers.formatDecimal(campaign.minOrderValue, 0, 'POINT', 0, 'COMMA')}">500.000</span> VNĐ
                                </span>
                                <span th:unless="${campaign.minOrderValue != null}" style="color: #9ca3af;">Không yêu cầu</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Target Application Section -->
                <div style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border: 2px solid #d8b4fe; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
                    <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 700; color: #6b21a8;">Phạm vi áp dụng</h3>
                    <div th:if="${campaign.targets != null and !campaign.targets.isEmpty()}">
                        <div style="color: #7c3aed; font-size: 13px; font-weight: 600; margin-bottom: 8px;">Loại áp dụng</div>
                        <div style="font-size: 16px; font-weight: 600; color: #6b21a8; margin-bottom: 16px;">
                            <span th:if="${campaign.targets[0].targetType.name() == 'ALL'}">Tất cả sản phẩm</span>
                            <span th:if="${campaign.targets[0].targetType.name() == 'PRODUCT'}">Sản phẩm cụ thể</span>
                            <span th:if="${campaign.targets[0].targetType.name() == 'CATEGORY'}">Theo danh mục</span>
                        </div>
                        
                        <!-- Show specific products -->
                        <div th:if="${campaign.targets[0].targetType.name() == 'PRODUCT'}">
                            <div style="color: #7c3aed; font-size: 13px; font-weight: 600; margin-bottom: 8px;">Sản phẩm được áp dụng</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <span th:each="target : ${campaign.targets}" 
                                      th:if="${target.shoe != null}"
                                      style="background: white; border: 1px solid #c084fc; border-radius: 6px; padding: 6px 12px; font-size: 14px; color: #6b21a8;"
                                      th:text="${target.shoe.name}">
                                    Sản phẩm
                                </span>
                            </div>
                        </div>
                        
                        <!-- Show categories -->
                        <div th:if="${campaign.targets[0].targetType.name() == 'CATEGORY'}">
                            <div style="color: #7c3aed; font-size: 13px; font-weight: 600; margin-bottom: 8px;">Danh mục được áp dụng</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <span th:each="target : ${campaign.targets}" 
                                      th:if="${target.category != null}"
                                      style="background: white; border: 1px solid #c084fc; border-radius: 6px; padding: 6px 12px; font-size: 14px; color: #6b21a8;"
                                      th:text="${target.category.categoryName}">
                                    Danh mục
                                </span>
                            </div>
                        </div>
                    </div>
                    <div th:unless="${campaign.targets != null and !campaign.targets.isEmpty()}" style="color: #9ca3af; font-style: italic;">
                        Chưa thiết lập phạm vi áp dụng
                    </div>
                </div>

                <!-- Vouchers Section -->
                <div style="background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%); border: 2px solid #fdba74; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
                    <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 700; color: #9a3412;">Danh sách Voucher</h3>
                    
                    <div th:if="${vouchers != null and !vouchers.isEmpty()}">
                        <div style="display: grid; gap: 12px;">
                            <div th:each="voucher : ${vouchers}" 
                                 style="background: white; border: 1px solid #fed7aa; border-radius: 8px; padding: 16px;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                            <code style="background: #fed7aa; color: #9a3412; padding: 4px 8px; border-radius: 4px; font-weight: 700; font-size: 14px;" 
                                                  th:text="${voucher.code}">VOUCHER123</code>
                                            <span th:if="${voucher.status != null}" class="badge"
                                                  th:classappend="${voucher.status.name() == 'ACTIVE'} ? ' badge-success' : (${voucher.status.name() == 'ENDED' || voucher.status.name() == 'CANCELLED'} ? ' badge-danger' : ' badge-warning')">
                                                <span th:if="${voucher.status.name() == 'DRAFT'}">Nháp</span>
                                                <span th:if="${voucher.status.name() == 'ACTIVE'}">Hoạt động</span>
                                                <span th:if="${voucher.status.name() == 'ENDED'}">Hết hạn</span>
                                                <span th:if="${voucher.status.name() == 'CANCELLED'}">Đã hủy</span>
                                            </span>
                                            <span th:if="${voucher.enabled}" class="chip-on" style="font-size: 12px;">Đang bật</span>
                                            <span th:unless="${voucher.enabled}" class="chip-off" style="font-size: 12px;">Đã tắt</span>
                                        </div>
                                        <div style="color: #78350f; font-weight: 600; font-size: 15px; margin-bottom: 4px;" 
                                             th:text="${voucher.title}">Tiêu đề voucher</div>
                                        <div style="color: #92400e; font-size: 13px;" 
                                             th:text="${voucher.description}">Mô tả voucher</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 20px; font-weight: 700; color: #9a3412;">
                                            <span th:text="${voucher.discountValue}">10</span>
                                            <span th:if="${voucher.discountType.name() == 'PERCENT'}">%</span>
                                            <span th:if="${voucher.discountType.name() == 'FIXED_AMOUNT'}">đ</span>
                                        </div>
                                        <div style="color: #92400e; font-size: 12px;">
                                            <span th:if="${voucher.maxDiscountValue != null}">
                                                Max: <span th:text="${#numbers.formatDecimal(voucher.maxDiscountValue, 0, 'COMMA', 0, 'POINT')}">100,000</span>đ
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid #fed7aa;">
                                    <div style="display: flex; gap: 16px; font-size: 13px; color: #92400e;">
                                        <span>
                                            <strong>Từ:</strong> <span th:text="${#temporals.format(voucher.startDate, 'dd/MM/yyyy')}">01/01/2024</span>
                                        </span>
                                        <span>
                                            <strong>Đến:</strong> <span th:text="${#temporals.format(voucher.endDate, 'dd/MM/yyyy')}">31/12/2024</span>
                                        </span>
                                        <span th:if="${voucher.minOrderValue != null}">
                                            <strong>Đơn tối thiểu:</strong> <span th:text="${#numbers.formatDecimal(voucher.minOrderValue, 0, 'COMMA', 0, 'POINT')}">100,000</span>đ
                                        </span>
                                        <span th:if="${voucher.maxRedeemPerCustomer != null}">
                                            <strong>Giới hạn:</strong> <span th:text="${voucher.maxRedeemPerCustomer}">5</span> lượt/KH
                                        </span>
                                    </div>
                                    <!-- Chỉ hiển thị thông tin, không cho sửa/xóa từ trang chi tiết chiến dịch -->
                                    <!-- Muốn sửa/xóa voucher thì vào danh sách voucher -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div th:unless="${vouchers != null and !vouchers.isEmpty()}" 
                         style="color: #9ca3af; font-style: italic; text-align: center; padding: 20px;">
                        Chưa có voucher nào trong chiến dịch này
                    </div>
                </div>


            </div>
        </main>
    </div>
</div>
<script>
    document.addEventListener('click', function (e) {
        if (!e.target.matches('.menu-toggle')) return;
        const sidebar = document.querySelector('.sidebar');
        if (sidebar) sidebar.classList.toggle('collapsed');
    });
</script>
</body>
</html>
