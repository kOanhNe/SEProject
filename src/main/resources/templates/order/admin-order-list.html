<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Qu·∫£n l√Ω ƒë∆°n h√†ng | WebShoe Admin</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Th√™m icon Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <link rel="stylesheet" th:href="@{/css/admin.css}"/>
    <link rel="stylesheet" th:href="@{/css/inventory.css}"/> <!-- T·∫≠n d·ª•ng CSS inventory cho ƒë·∫πp -->
    <link rel="stylesheet" th:href="@{/css/common.css}"/>
    
    <style>
        /* CSS ri√™ng cho trang Order ƒë·ªÉ ƒë·∫πp h∆°n */
        .stat-card {
            border: none;
            border-radius: 12px;
            padding: 20px;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card h3 { font-size: 28px; font-weight: 700; margin: 0; }
        .stat-card p { font-size: 14px; opacity: 0.8; margin: 0; }
        .stat-icon { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 40px; opacity: 0.3; }
        
        .bg-gradient-primary { background: linear-gradient(45deg, #4e73df, #224abe); }
        .bg-gradient-success { background: linear-gradient(45deg, #1cc88a, #13855c); }
        .bg-gradient-warning { background: linear-gradient(45deg, #f6c23e, #dda20a); }
        .bg-gradient-danger { background: linear-gradient(45deg, #e74a3b, #be2617); }

        .table-avatar { width: 40px; height: 40px; background: #eef2f7; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #555; margin-right: 10px; }
    </style>
</head>
<body>

<div class="admin-layout">

    <aside class="sidebar">
        <div th:replace="~{admin/sidebar :: sidebar}"></div>
    </aside>

    <div class="main">

        <header class="topbar">
            <div class="topbar-inner">
                <div class="topbar-left">
                    <button class="menu-toggle">‚ò∞</button>
                    <h3>Qu·∫£n l√Ω ƒë∆°n h√†ng</h3>
                </div>
                <div class="topbar-right">
                    <div th:replace="~{admin/inventory/inventory-notification :: notification-bell}"></div>
                    <div class="user" style="margin-left: 15px; font-weight: 600;">Admin</div>
                </div>
            </div>
        </header>

        <main class="page-content">
            
            <!-- 1. TH·ªêNG K√ä NHANH (Ph·∫ßn th√™m m·ªõi cho ƒë·∫πp) -->
            <div class="row g-4 mb-4">
                <div class="col-md-3">
                    <div class="stat-card bg-gradient-primary">
                        <div>
                            <p>T·ªïng ƒë∆°n h√†ng</p>
                            <h3 th:text="${totalElements}">0</h3>
                        </div>
                        <i class="bi bi-receipt stat-icon"></i>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card bg-gradient-warning">
                        <div>
                            <p>Ch·ªù x√°c nh·∫≠n</p>
                            <h3>--</h3> <!-- Sau n√†y bind data v√†o ƒë√¢y -->
                        </div>
                        <i class="bi bi-hourglass-split stat-icon"></i>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card bg-gradient-success">
                        <div>
                            <p>Ho√†n th√†nh</p>
                            <h3>--</h3>
                        </div>
                        <i class="bi bi-check-circle stat-icon"></i>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card bg-gradient-danger">
                        <div>
                            <p>ƒê√£ h·ªßy</p>
                            <h3>--</h3>
                        </div>
                        <i class="bi bi-x-circle stat-icon"></i>
                    </div>
                </div>
            </div>

            <!-- 2. DANH S√ÅCH ƒê∆†N H√ÄNG -->
            <div class="card border-0 shadow-sm rounded-4 p-4">
                
                <!-- Toolbar -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="mb-0 fw-bold text-secondary">üì¶ Danh s√°ch chi ti·∫øt</h5>
                    <div class="d-flex gap-2">
                        <form class="d-flex search-group" style="max-width: 300px;">
                            <input class="form-control me-2" type="search" placeholder="T√¨m theo M√£ ƒêH, T√™n KH..." aria-label="Search">
                            <button class="btn btn-outline-primary" type="submit">T√¨m</button>
                        </form>
                        <button class="btn btn-outline-secondary"><i class="bi bi-funnel"></i> L·ªçc</button>
                    </div>
                </div>

                <!-- B·∫£ng d·ªØ li·ªáu -->
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>M√£ ƒêH</th>
                                <th>Kh√°ch h√†ng</th>
                                <th>Ng√†y ƒë·∫∑t</th>
                                <th class="text-center">Tr·∫°ng th√°i</th>
                                <th class="text-end">T·ªïng ti·ªÅn</th>
                                <th class="text-end">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- N·∫øu kh√¥ng c√≥ ƒë∆°n h√†ng -->
                            <tr th:if="${orders == null || orders.isEmpty()}">
                                <td colspan="6" class="text-center py-5">
                                    <i class="bi bi-inbox fs-1 text-muted d-block mb-3"></i>
                                    <p class="text-muted">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o trong h·ªá th·ªëng.</p>
                                </td>
                            </tr>

                            <!-- L·∫∑p d·ªØ li·ªáu -->
                            <tr th:each="order : ${orders}">
                                <td>
                                    <a href="#" class="fw-bold text-decoration-none text-primary">
                                        #<span th:text="${order.orderId}">101</span>
                                    </a>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="table-avatar">
                                            <span th:text="${#strings.substring(order.customerName,0,1)}">A</span>
                                        </div>
                                        <div>
                                            <div class="fw-bold text-dark" th:text="${order.customerName}">T√™n Kh√°ch</div>
                                            <small class="text-muted" th:text="${order.customerEmail}">email@example.com</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span th:text="${#temporals.format(order.createAt, 'dd/MM/yyyy HH:mm')}"></span>
                                </td>
                                
                                <td class="text-center">
                                    <!-- Badge m√†u s·∫Øc -->
                                    <span class="badge rounded-pill" 
                                          th:classappend="'bg-' + ${order.statusColorClass}"
                                          th:text="${order.statusDisplay}">
                                        Tr·∫°ng th√°i
                                    </span>
                                </td>

                                <td class="text-end fw-bold text-dark">
                                    <span th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></span>
                                </td>

                                <td class="text-end">
                                    <div class="btn-group">
                                        <a href="#" class="btn btn-sm btn-light border" title="Xem chi ti·∫øt">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                        <button type="button" class="btn btn-sm btn-light border dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
                                            <span class="visually-hidden">Toggle Dropdown</span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <!-- C·∫≠p nh·∫≠t nhanh tr·∫°ng th√°i -->
                                            <li><h6 class="dropdown-header">C·∫≠p nh·∫≠t tr·∫°ng th√°i</h6></li>
                                            
                                            <li th:if="${order.status.name() == 'PENDING'}">
                                                <form th:action="@{/admin/orders/update-status}" method="post">
                                                    <input type="hidden" name="orderId" th:value="${order.orderId}">
                                                    <input type="hidden" name="newStatus" value="CONFIRMED">
                                                    <button class="dropdown-item text-primary"><i class="bi bi-check-lg"></i> X√°c nh·∫≠n</button>
                                                </form>
                                            </li>
                                            
                                            <li>
                                                <form th:action="@{/admin/orders/update-status}" method="post">
                                                    <input type="hidden" name="orderId" th:value="${order.orderId}">
                                                    <input type="hidden" name="newStatus" value="CANCELLED">
                                                    <button class="dropdown-item text-danger"><i class="bi bi-x-circle"></i> H·ªßy ƒë∆°n</button>
                                                </form>
                                            </li>
                                            <li th:if="${order.status.name() == 'CONFIRMED'}">
                                                <form th:action="@{/admin/orders/update-status}" method="post">
                                                    <input type="hidden" name="orderId" th:value="${order.orderId}">
                                                    <input type="hidden" name="newStatus" value="SHIPPING"> <!-- G·ª≠i SHIPPING -->
                                                    <button class="dropdown-item text-info"><i class="bi bi-truck"></i> B·∫Øt ƒë·∫ßu giao</button>
                                                </form>
                                            </li>
                                            <li th:if="${order.status.name() == 'SHIPPING'}">
                                                <form th:action="@{/admin/orders/update-status}" method="post">
                                                    <input type="hidden" name="orderId" th:value="${order.orderId}">
                                                    <input type="hidden" name="newStatus" value="COMPLETED"> <!-- G·ª≠i COMPLETED -->
                                                    <button class="dropdown-item text-success"><i class="bi bi-check-circle-fill"></i> Giao th√†nh c√¥ng</button>
                                                </form>
                                            </li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li th:if="${order.status.name() != 'COMPLETED' && order.status.name() != 'CANCELED'}">
                                                <form th:action="@{/admin/orders/update-status}" method="post">
                                                    <input type="hidden" name="orderId" th:value="${order.orderId}">
                                                    <input type="hidden" name="newStatus" value="CANCELED"> <!-- G·ª≠i CANCELED -->
                                                    <button class="dropdown-item text-danger" onclick="return confirm('H·ªßy ƒë∆°n n√†y?');"><i class="bi bi-x-circle"></i> H·ªßy ƒë∆°n</button>
                                                </form>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Ph√¢n trang -->
                <nav th:if="${totalPages > 1}" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled"><a class="page-link" href="#">Tr∆∞·ªõc</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">Sau</a></li>
                    </ul>
                </nav>

            </div>
        </main>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>